# Drupal

{% hint style="success" %}
学习与实践 AWS 黑客技术：<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks 培训 AWS 红队专家 (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
学习与实践 GCP 黑客技术：<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks 培训 GCP 红队专家 (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>支持 HackTricks</summary>

* 查看 [**订阅计划**](https://github.com/sponsors/carlospolop)!
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram 群组**](https://t.me/peass) 或 **关注** 我们的 **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub 仓库提交 PR 分享黑客技巧。

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## 发现

* 检查 **meta**
```bash
curl https://www.drupal.org/ | grep 'content="Drupal'
```
* **节点**: Drupal **使用节点索引其内容**。一个节点可以 **包含任何内容**，例如博客文章、投票、文章等。页面 URI 通常为 `/node/<nodeid>`。
```bash
curl drupal-site.com/node/1
```
## Enumeration

Drupal 默认支持 **三种类型的用户**：

1. **`Administrator`**: 该用户对 Drupal 网站拥有完全控制权。
2. **`Authenticated User`**: 这些用户可以登录网站，并根据其权限执行添加和编辑文章等操作。
3. **`Anonymous`**: 所有网站访问者被指定为匿名用户。默认情况下，这些用户仅被允许阅读帖子。

### Version

* 检查 `/CHANGELOG.txt`
```bash
curl -s http://drupal-site.local/CHANGELOG.txt | grep -m2 ""

Drupal 7.57, 2018-02-21
```
{% hint style="info" %}
较新的 Drupal 安装默认阻止访问 `CHANGELOG.txt` 和 `README.txt` 文件。
{% endhint %}

### 用户名枚举

#### 注册

在 _/user/register_ 中尝试创建一个用户名，如果该名称已被占用，将会收到通知：

![](<../../../.gitbook/assets/image (328).png>)

#### 请求新密码

如果您为现有用户名请求新密码：

![](<../../../.gitbook/assets/image (903).png>)

如果您为不存在的用户名请求新密码：

![](<../../../.gitbook/assets/image (307).png>)

### 获取用户数量

访问 _/user/\<number>_ 您可以看到现有用户的数量，在这种情况下是 2，因为 _/users/3_ 返回未找到错误：

![](<../../../.gitbook/assets/image (333).png>)

![](<../../../.gitbook/assets/image (227) (1) (1) (1).png>)

### 隐藏页面

**模糊 `/node/$` 其中 `$` 是一个数字**（例如从 1 到 500）。\
您可能会找到 **隐藏页面**（测试、开发），这些页面未被搜索引擎引用。

#### 已安装模块信息
```bash
#From https://twitter.com/intigriti/status/1439192489093644292/photo/1
#Get info on installed modules
curl https://example.com/config/sync/core.extension.yml
curl https://example.com/core/core.services.yml

# Download content from files exposed in the previous step
curl https://example.com/config/sync/swiftmailer.transport.yml
```
### 自动化
```bash
droopescan scan drupal -u http://drupal-site.local
```
## RCE

如果您可以访问Drupal web控制台，请检查这些选项以获取RCE：

{% content-ref url="drupal-rce.md" %}
[drupal-rce.md](drupal-rce.md)
{% endcontent-ref %}

## Drupal 从 XSS 到 RCE
通过此技术，可以通过**跨站脚本攻击 (XSS)** 在Drupal中实现**远程代码执行 (RCE)**。 https://github.com/nowak0x01/Drupalwned
<br><br>
**有关更详细的步骤，请查看：** https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html

## 后期利用

### 阅读 settings.php
```
find / -name settings.php -exec grep "drupal_hash_salt\|'database'\|'username'\|'password'\|'host'\|'port'\|'driver'\|'prefix'" {} \; 2>/dev/null
```
### 从数据库中导出用户
```
mysql -u drupaluser --password='2r9u8hu23t532erew' -e 'use drupal; select * from users'
```
## 参考

* [https://academy.hackthebox.com/module/113/section/1209](https://academy.hackthebox.com/module/113/section/1209)

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
学习与实践 AWS 黑客技术：<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks 培训 AWS 红队专家 (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
学习与实践 GCP 黑客技术：<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks 培训 GCP 红队专家 (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>支持 HackTricks</summary>

* 查看 [**订阅计划**](https://github.com/sponsors/carlospolop)!
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或 **关注** 我们的 **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来分享黑客技巧。

</details>
{% endhint %}
